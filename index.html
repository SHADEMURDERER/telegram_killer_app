<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Gizmo App</title>
<style>
body {
  margin: 0;
  background: #2a2826;
  color: white;
  font-family: 'Arial', sans-serif;
  height: 100vh;
  overflow: hidden;
  perspective: 1000px;
}

#ring-container {
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%) translateZ(0);
  width: 100vw;
  height: 100vh;
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 1000;
  background-color: #2a2826;
  transform-style: preserve-3d;
}

#ring {
  width: 600px;
  height: 600px;
  background: url('./images/anim.gif') center/contain no-repeat;
  animation: 
    rotate 4s linear infinite,
    initialZoom 2s ease-out forwards;
  transform-style: preserve-3d;
}

#title {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  font-size: 4.5rem;
  font-weight: bold;
  color: white;
  text-shadow: 0 0 15px rgba(255,255,255,0.7);
  opacity: 0;
  filter: blur(15px);
  z-index: 1001;
  animation: 
    titleAppear 1.5s 4s ease-out forwards,
    titleMoveUp 1.5s 6s ease-out forwards;
}

#panel {
  position: fixed;
  bottom: -300px;
  left: 50%;
  transform: translateX(-50%);
  width: 90%;
  max-width: 500px;
  background: rgba(42, 40, 38, 0.97);
  backdrop-filter: blur(12px);
  border-radius: 25px;
  padding: 25px;
  box-shadow: 0 -8px 30px rgba(0,0,0,0.4);
  z-index: 1002;
  animation: slideUp 1.5s 6s ease-out forwards;
  will-change: transform;
  border: 1px solid #3a3836;
}

@keyframes rotate {
  from { transform: rotate(0deg); }
  to { transform: rotate(360deg); }
}

@keyframes initialZoom {
  0% { transform: scale(0.5); opacity: 0; }
  50% { transform: scale(1.2); opacity: 1; }
  100% { transform: scale(1); opacity: 1; }
}

@keyframes flyThrough {
  0% { transform: scale(1) translateZ(0); opacity: 1; }
  100% { transform: scale(5) translateZ(800px); opacity: 0; }
}

@keyframes titleAppear {
  0% { opacity: 0; filter: blur(15px); transform: translate(-50%, -50%) scale(0.8); }
  100% { opacity: 1; filter: blur(0); transform: translate(-50%, -50%) scale(1); }
}

@keyframes titleMoveUp {
  0% { top: 50%; opacity: 1; }
  100% { top: 20%; opacity: 0.7; }
}

@keyframes slideUp {
  0% { bottom: -300px; opacity: 0; }
  100% { bottom: 30px; opacity: 1; }
}

.tab-content { 
  display: none;
  text-align: center;
}
.tab-content.active { display: block; }

.tab-buttons {
  display: flex;
  justify-content: center;
  gap: 25px;
  margin-bottom: 25px;
}

.tab-button {
  background: none;
  border: none;
  color: white;
  padding: 12px 25px;
  font-size: 1.3rem;
  cursor: pointer;
  position: relative;
  transition: all 0.3s ease;
}

.tab-button.active {
  color: #7f5af0;
  text-shadow: 0 0 8px #7f5af0;
}

.shop-item {
  margin: 15px 0;
  padding: 15px;
  background: rgba(58, 56, 54, 0.5);
  border-radius: 12px;
  border-left: 3px solid #7f5af0;
}

/* PVP Bar Styles */
#pvp-container {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0,0,0,0.8);
  z-index: 2000;
  justify-content: center;
  align-items: center;
  flex-direction: column;
}

#progress-bar {
  width: 80%;
  max-width: 400px;
  height: 40px;
  background: #3a3836;
  border-radius: 20px;
  overflow: hidden;
  position: relative;
  margin: 20px 0;
}

#progress-fill {
  height: 100%;
  width: 50%;
  background: linear-gradient(90deg, #FF5252 0%, #4FC3F7 100%);
  transition: width 0.3s;
}

#progress-pointer {
  position: absolute;
  top: -10px;
  left: 50%;
  transform: translateX(-50%);
  width: 0;
  height: 0;
  border-left: 15px solid transparent;
  border-right: 15px solid transparent;
  border-top: 20px solid #7f5af0;
}

#pvp-result {
  margin: 20px 0;
  font-size: 1.5rem;
  color: #7f5af0;
  text-shadow: 0 0 8px #7f5af0;
}

#pvp-bet {
  padding: 10px 20px;
  background: #7f5af0;
  color: white;
  border: none;
  border-radius: 10px;
  font-size: 1.2rem;
  cursor: pointer;
  margin-top: 20px;
}

#pvp-status {
  margin-bottom: 20px;
  font-size: 1.2rem;
}

.player-info {
  display: flex;
  justify-content: space-between;
  width: 80%;
  max-width: 400px;
  margin-bottom: 10px;
}

.player {
  display: flex;
  align-items: center;
}

.player-color {
  width: 20px;
  height: 20px;
  border-radius: 50%;
  margin-right: 10px;
}

#player1-color { background: #FF5252; }
#player2-color { background: #4FC3F7; }
</style>
</head>
<body>

<div id="ring-container">
  <div id="ring"></div>
</div>

<div id="title">Gizmo</div>

<div id="content">
  <div id="panel">
    <div class="tab-buttons">
      <button class="tab-button active" onclick="switchTab('profile')">–ü—Ä–æ—Ñ–∏–ª—å</button>
      <button class="tab-button" onclick="switchTab('shop')">–ú–∞–≥–∞–∑–∏–Ω</button>
      <button class="tab-button" onclick="openPvpGame()">PVP</button>
    </div>
    
    <div id="profile" class="tab-content active">
      <h2>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, <span id="username">–ò–≥—Ä–æ–∫</span>!</h2>
      <p>–í–∞—à —Å—Ç–∞—Ç—É—Å: –ù–æ–≤–∏—á–æ–∫</p>
    </div>
    
    <div id="shop" class="tab-content">
      <div class="shop-item">
        <h3>üó°Ô∏è –ú–µ—á –î—Ä–∞–∫–æ–Ω–∞</h3>
        <p style="color: #f8d56b;">100 –∑–æ–ª–æ—Ç—ã—Ö</p>
      </div>
      <div class="shop-item">
        <h3>üõ°Ô∏è –©–∏—Ç –†—ã—Ü–∞—Ä—è</h3>
        <p style="color: #f8d56b;">75 –∑–æ–ª–æ—Ç—ã—Ö</p>
      </div>
    </div>
  </div>
</div>

<div id="pvp-container">
  <div id="pvp-status">–û–∂–∏–¥–∞–Ω–∏–µ –∏–≥—Ä–æ–∫–æ–≤...</div>
  
  <div class="player-info">
    <div class="player">
      <div class="player-color" id="player1-color"></div>
      <span id="player1-name">–í—ã</span>
    </div>
    <div class="player">
      <div class="player-color" id="player2-color"></div>
      <span id="player2-name">–°–æ–ø–µ—Ä–Ω–∏–∫</span>
    </div>
  </div>
  
  <div id="progress-bar">
    <div id="progress-fill"></div>
    <div id="progress-pointer"></div>
  </div>
  
  <div id="pvp-result"></div>
  <button id="pvp-bet" onclick="placeBet()">–°–¥–µ–ª–∞—Ç—å —Å—Ç–∞–≤–∫—É (50 –∑–æ–ª–æ—Ç—ã—Ö)</button>
</div>

<script>
// –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
let currentPlayer = {
  id: null,
  name: '–ò–≥—Ä–æ–∫'
};
let gameState = {
  player1: null,
  player2: null,
  spinning: false,
  lastUpdate: 0,
  winner: null
};

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
document.addEventListener('DOMContentLoaded', () => {
  // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram WebApp
  if (window.Telegram && Telegram.WebApp) {
    const user = Telegram.WebApp.initDataUnsafe.user;
    if (user?.id) {
      currentPlayer.id = 'tg_' + user.id;
      currentPlayer.name = user.first_name || '–ò–≥—Ä–æ–∫';
      document.getElementById('username').textContent = currentPlayer.name;
    }
    Telegram.WebApp.expand();
  } else {
    // –î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –±–µ–∑ Telegram
    currentPlayer.id = 'local_' + Math.random().toString(36).substring(2, 9);
    currentPlayer.name = '–ò–≥—Ä–æ–∫';
  }
  
  // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è UI
  const elements = document.querySelectorAll('#ring, #title, #panel');
  elements.forEach(el => {
    el.style.willChange = 'transform, opacity, filter';
  });
  
  // –ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∏–≥—Ä—ã
  loadGameState();
  
  // –ó–∞–ø—É—Å–∫ –∞–Ω–∏–º–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ 4 —Å–µ–∫—É–Ω–¥—ã
  setTimeout(() => {
    document.getElementById('ring').style.animation = 'none';
    document.getElementById('ring').style.animation = 'flyThrough 2s ease-out forwards';
    
    setTimeout(() => {
      document.getElementById('ring-container').style.opacity = '0';
      setTimeout(() => {
        document.getElementById('ring-container').remove();
      }, 1000);
    }, 2000);
  }, 4000);
  
  // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∏–≥—Ä—ã –∫–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É
  setInterval(checkGameState, 1000);
});

function switchTab(tabName) {
  document.querySelectorAll('.tab-content').forEach(tab => {
    tab.classList.remove('active');
  });
  document.querySelectorAll('.tab-button').forEach(btn => {
    btn.classList.remove('active');
  });
  
  document.getElementById(tabName).classList.add('active');
  event.target.classList.add('active');
}

// PVP Game Logic
function openPvpGame() {
  document.getElementById('pvp-container').style.display = 'flex';
  updateGameUI();
}

function loadGameState() {
  const savedState = localStorage.getItem('pvpGameState');
  if (savedState) {
    const parsedState = JSON.parse(savedState);
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ —É—Å—Ç–∞—Ä–µ–ª–æ –ª–∏ —Å–æ—Å—Ç–æ—è–Ω–∏–µ (–±–æ–ª—å—à–µ 2 –º–∏–Ω—É—Ç)
    if (Date.now() - parsedState.lastUpdate < 120000) {
      gameState = parsedState;
    } else {
      resetGameState();
    }
  }
}

function saveGameState() {
  gameState.lastUpdate = Date.now();
  localStorage.setItem('pvpGameState', JSON.stringify(gameState));
}

function resetGameState() {
  gameState = {
    player1: null,
    player2: null,
    spinning: false,
    lastUpdate: Date.now(),
    winner: null
  };
  saveGameState();
}

function checkGameState() {
  const oldState = JSON.stringify(gameState);
  loadGameState();
  
  // –ï—Å–ª–∏ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å, –æ–±–Ω–æ–≤–ª—è–µ–º UI
  if (JSON.stringify(gameState) !== oldState) {
    updateGameUI();
  }
  
  // –ï—Å–ª–∏ –æ–±–∞ –∏–≥—Ä–æ–∫–∞ –Ω–∞ –º–µ—Å—Ç–µ, –Ω–æ –∏–≥—Ä–∞ –Ω–µ –Ω–∞—á–∞–ª–∞—Å—å
  if (gameState.player1 && gameState.player2 && !gameState.spinning) {
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –æ–±–∞ –∏–≥—Ä–æ–∫–∞ —Ä–∞–∑–Ω—ã–µ
    if (gameState.player1.id !== gameState.player2.id) {
      startGame();
    } else {
      // –ï—Å–ª–∏ —ç—Ç–æ –æ–¥–∏–Ω –∏ —Ç–æ—Ç –∂–µ –∏–≥—Ä–æ–∫, —Å–±—Ä–∞—Å—ã–≤–∞–µ–º –∏–≥—Ä—É
      resetGameState();
    }
  }
}

function updateGameUI() {
  const betButton = document.getElementById('pvp-bet');
  const statusElement = document.getElementById('pvp-status');
  const resultElement = document.getElementById('pvp-result');
  const progressFill = document.getElementById('progress-fill');
  
  // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç, –µ—Å–ª–∏ –∏–≥—Ä–∞ –Ω–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∞
  if (!gameState.winner) {
    resultElement.textContent = '';
  }
  
  // –û–ø—Ä–µ–¥–µ–ª—è–µ–º, —É—á–∞—Å—Ç–≤—É–µ—Ç –ª–∏ —Ç–µ–∫—É—â–∏–π –∏–≥—Ä–æ–∫ –≤ –∏–≥—Ä–µ
  const isPlayer1 = gameState.player1 && gameState.player1.id === currentPlayer.id;
  const isPlayer2 = gameState.player2 && gameState.player2.id === currentPlayer.id;
  const isInGame = isPlayer1 || isPlayer2;
  
  if (gameState.spinning) {
    // –ò–≥—Ä–∞ —É–∂–µ –∏–¥–µ—Ç
    betButton.disabled = true;
    betButton.textContent = '–ò–¥–µ—Ç –∏–≥—Ä–∞...';
    statusElement.textContent = '–ò–¥–µ—Ç –∏–≥—Ä–∞...';
    progressFill.style.width = '100%';
    progressFill.style.background = 'linear-gradient(90deg, #FF5252 0%, #4FC3F7 100%)';
    return;
  }
  
  // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ–± –∏–≥—Ä–æ–∫–∞—Ö
  if (gameState.player1) {
    document.getElementById('player1-name').textContent = 
      gameState.player1.id === currentPlayer.id ? '–í—ã' : gameState.player1.name;
  } else {
    document.getElementById('player1-name').textContent = '–û–∂–∏–¥–∞–Ω–∏–µ...';
  }
  
  if (gameState.player2) {
    document.getElementById('player2-name').textContent = 
      gameState.player2.id === currentPlayer.id ? '–í—ã' : gameState.player2.name;
  } else {
    document.getElementById('player2-name').textContent = '–û–∂–∏–¥–∞–Ω–∏–µ...';
  }
  
  // –û–±–Ω–æ–≤–ª—è–µ–º UI –∫–Ω–æ–ø–∫–∏ –∏ —Å—Ç–∞—Ç—É—Å–∞
  if (gameState.player1 && gameState.player2) {
    // –û–±–∞ –∏–≥—Ä–æ–∫–∞ –Ω–∞ –º–µ—Å—Ç–µ
    if (isInGame) {
      betButton.disabled = true;
      betButton.textContent = '–û–∂–∏–¥–∞–Ω–∏–µ –∑–∞–ø—É—Å–∫–∞...';
      statusElement.textContent = '–û–±–∞ –∏–≥—Ä–æ–∫–∞ –≥–æ—Ç–æ–≤—ã!';
    } else {
      betButton.disabled = true;
      betButton.textContent = '–ò–≥—Ä–∞ —É–∂–µ –Ω–∞—á–∞–ª–∞—Å—å';
      statusElement.textContent = '–ò–≥—Ä–∞ –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ';
    }
    progressFill.style.width = '100%';
    progressFill.style.background = 'linear-gradient(90deg, #FF5252 0%, #4FC3F7 100%)';
  } else if (gameState.player1 || gameState.player2) {
    // –¢–æ–ª—å–∫–æ –æ–¥–∏–Ω –∏–≥—Ä–æ–∫
    if (isInGame) {
      betButton.disabled = true;
      betButton.textContent = '–û–∂–∏–¥–∞–Ω–∏–µ —Å–æ–ø–µ—Ä–Ω–∏–∫–∞...';
      statusElement.textContent = '–û–∂–∏–¥–∞–Ω–∏–µ –≤—Ç–æ—Ä–æ–≥–æ –∏–≥—Ä–æ–∫–∞';
      progressFill.style.width = '50%';
      progressFill.style.background = isPlayer1 ? '#FF5252' : '#4FC3F7';
    } else {
      betButton.disabled = false;
      betButton.textContent = '–ü—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è (50 –∑–æ–ª–æ—Ç—ã—Ö)';
      statusElement.textContent = '–ú–æ–∂–Ω–æ –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è';
      progressFill.style.width = gameState.player1 ? '50%' : '0%';
      progressFill.style.background = '#FF5252';
    }
  } else {
    // –ù–µ—Ç –∏–≥—Ä–æ–∫–æ–≤
    betButton.disabled = false;
    betButton.textContent = '–°–æ–∑–¥–∞—Ç—å –∏–≥—Ä—É (50 –∑–æ–ª–æ—Ç—ã—Ö)';
    statusElement.textContent = '–û–∂–∏–¥–∞–Ω–∏–µ –∏–≥—Ä–æ–∫–æ–≤...';
    progressFill.style.width = '0%';
  }
}

function placeBet() {
  if (gameState.spinning) return;
  
  // –ï—Å–ª–∏ –∏–≥—Ä–æ–∫ —É–∂–µ –≤ –∏–≥—Ä–µ, –Ω–∏—á–µ–≥–æ –Ω–µ –¥–µ–ª–∞–µ–º
  if ((gameState.player1 && gameState.player1.id === currentPlayer.id) || 
      (gameState.player2 && gameState.player2.id === currentPlayer.id)) {
    return;
  }
  
  if (!gameState.player1) {
    gameState.player1 = currentPlayer;
  } else if (!gameState.player2 && gameState.player1.id !== currentPlayer.id) {
    gameState.player2 = currentPlayer;
  }
  
  saveGameState();
  updateGameUI();
}

function startGame() {
  gameState.spinning = true;
  saveGameState();
  
  const betButton = document.getElementById('pvp-bet');
  const statusElement = document.getElementById('pvp-status');
  const resultElement = document.getElementById('pvp-result');
  const progressFill = document.getElementById('progress-fill');
  
  betButton.disabled = true;
  statusElement.textContent = '–û–ø—Ä–µ–¥–µ–ª—è–µ–º –ø–æ–±–µ–¥–∏—Ç–µ–ª—è...';
  
  // –ê–Ω–∏–º–∞—Ü–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä–∞
  let progress = 0;
  const interval = setInterval(() => {
    progress += 2;
    progressFill.style.width = progress + '%';
    
    if (progress >= 100) {
      clearInterval(interval);
      finishGame();
    }
  }, 50);
}

function finishGame() {
  // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –ø–æ–±–µ–¥–∏—Ç–µ–ª—è (50/50)
  const isPlayer1Winner = Math.random() < 0.5;
  gameState.winner = isPlayer1Winner ? gameState.player1 : gameState.player2;
  
  const resultElement = document.getElementById('pvp-result');
  const isWinner = gameState.winner.id === currentPlayer.id;
  
  resultElement.textContent = isWinner ? '–í—ã –ø–æ–±–µ–¥–∏–ª–∏! +50 –∑–æ–ª–æ—Ç—ã—Ö' : '–í—ã –ø—Ä–æ–∏–≥—Ä–∞–ª–∏!';
  resultElement.style.color = isWinner ? '#4CAF50' : '#F44336';
  
  // –û–±–Ω–æ–≤–ª—è–µ–º UI
  updateGameUI();
  
  // –ß–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥ —Å–±—Ä–∞—Å—ã–≤–∞–µ–º –∏–≥—Ä—É
  setTimeout(() => {
    resetGameState();
    updateGameUI();
  }, 5000);
}
</script>
</body>
</html>