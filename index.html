<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Gizmo App</title>
  <link rel="stylesheet" href="styles/main.css">
  <link rel="stylesheet" href="styles/animation.css">
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
</head>
<body>
<div id="ring-container">
  <div id="ring"></div>
</div>
<div id="title">Gizmo</div>
<div id="content">
  <div id="panel">
    <div class="tab-buttons">
      <button class="tab-button active" onclick="switchTab('profile')">–ü—Ä–æ—Ñ–∏–ª—å</button>
      <button class="tab-button" onclick="switchTab('shop')">–ú–∞–≥–∞–∑–∏–Ω</button>
      <button class="tab-button" onclick="window.location.href='pvp-game.html'">PVP</button>
    </div>
    
    <div id="profile" class="tab-content active">
      <h2>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, <span id="username">–ò–≥—Ä–æ–∫</span>!</h2>
      <p>–í–∞—à –Ω–∏–∫: <span id="user-nickname">@username</span></p>
      <input type="text" id="nickname-input" placeholder="–ù–æ–≤—ã–π –Ω–∏–∫">
      <button onclick="updateNickname()">–ò–∑–º–µ–Ω–∏—Ç—å –Ω–∏–∫</button>
      <p>–í–∞—à —Å—Ç–∞—Ç—É—Å: –ù–æ–≤–∏—á–æ–∫</p>
    </div>
    
    <div id="shop" class="tab-content">
      <div class="shop-item">
        <h3>üó°Ô∏è –ú–µ—á –î—Ä–∞–∫–æ–Ω–∞</h3>
        <p style="color: #f8d56b;">100 –∑–æ–ª–æ—Ç—ã—Ö</p>
      </div>
      <div class="shop-item">
        <h3>üõ°Ô∏è –©–∏—Ç –†—ã—Ü–∞—Ä—è</h3>
        <p style="color: #f8d56b;">75 –∑–æ–ª–æ—Ç—ã—Ö</p>
      </div>
    </div>
  </div>
</div>

<script src="scripts/main.js"></script>
<script src="scripts/animation.js"></script>
<script>
  // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è WebApp Telegram
  const tg = window.Telegram.WebApp;
  tg.expand();
  
  // –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  let userData = {
    id: tg.initDataUnsafe?.user?.id || getUrlParam('user_id'),
    username: tg.initDataUnsafe?.user?.username || null,
    first_name: tg.initDataUnsafe?.user?.first_name || '–ò–≥—Ä–æ–∫'
  };

  // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º username
  if (userData.username) {
    userData.username = '@' + userData.username;
  } else {
    userData.username = 'tg://user?id=' + userData.id;
  }

  // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
  document.getElementById('username').textContent = userData.first_name;
  document.getElementById('user-nickname').textContent = userData.username;

  // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –Ω–∏–∫–∞
  async function updateNickname() {
    const newNickname = document.getElementById('nickname-input').value.trim();
    if (newNickname) {
      try {
        const response = await fetch('https://SHADEMURDERER.github.io/telegram_killer_app/api/update_nickname', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({
            user_id: userData.id,
            nickname: newNickname
          })
        });
        
        if (response.ok) {
          document.getElementById('user-nickname').textContent = newNickname;
          alert('–ù–∏–∫ —É—Å–ø–µ—à–Ω–æ –∏–∑–º–µ–Ω–µ–Ω!');
        }
      } catch (error) {
        console.error('–û—à–∏–±–∫–∞:', error);
      }
    }
  }

  // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ URL
  function getUrlParam(name) {
    const urlParams = new URLSearchParams(window.location.search);
    return urlParams.get(name);
  }

  // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Firebase
  const firebaseConfig = {
    apiKey: "AIzaSyC6EklCDD25kU_nuXyeh5mj9F24KECyYpM",
    databaseURL: "https://gizmo-27843-default-rtdb.firebaseio.com"
  };
  
  const app = firebase.initializeApp(firebaseConfig);
  window.db = firebase.database(app);
</script>
</body>
</html>