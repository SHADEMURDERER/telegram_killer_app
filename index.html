<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Gizmo App</title>
<style>
body {
  margin: 0;
  background: #2a2826;
  color: white;
  font-family: 'Arial', sans-serif;
  height: 100vh;
  overflow: hidden;
  perspective: 1000px;
}

#ring-container {
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%) translateZ(0);
  width: 100vw;
  height: 100vh;
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 1000;
  background-color: #2a2826;
  transform-style: preserve-3d;
}

#ring {
  width: 600px;
  height: 600px;
  background: url('./images/anim.gif') center/contain no-repeat;
  animation: 
    rotate 4s linear infinite,
    initialZoom 2s ease-out forwards;
  transform-style: preserve-3d;
}

#title {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  font-size: 4.5rem;
  font-weight: bold;
  color: white;
  text-shadow: 0 0 15px rgba(255,255,255,0.7);
  opacity: 0;
  filter: blur(15px);
  z-index: 1001;
  animation: 
    titleAppear 1.5s 4s ease-out forwards,
    titleMoveUp 1.5s 6s ease-out forwards;
}

#panel {
  position: fixed;
  bottom: -300px;
  left: 50%;
  transform: translateX(-50%);
  width: 90%;
  max-width: 500px;
  background: rgba(42, 40, 38, 0.97);
  backdrop-filter: blur(12px);
  border-radius: 25px;
  padding: 25px;
  box-shadow: 0 -8px 30px rgba(0,0,0,0.4);
  z-index: 1002;
  animation: slideUp 1.5s 6s ease-out forwards;
  will-change: transform;
  border: 1px solid #3a3836;
}

.chat-container {
  display: none;
  position: fixed;
  bottom: 100px;
  left: 50%;
  transform: translateX(-50%);
  width: 90%;
  max-width: 500px;
  height: 300px;
  background: rgba(42, 40, 38, 0.95);
  border-radius: 15px;
  padding: 15px;
  box-shadow: 0 0 20px rgba(0,0,0,0.5);
  z-index: 1003;
  flex-direction: column;
}

.chat-messages {
  flex-grow: 1;
  overflow-y: auto;
  padding: 10px;
  margin-bottom: 10px;
  border-bottom: 1px solid #3a3836;
}

.chat-input {
  display: flex;
  gap: 10px;
}

.chat-input input {
  flex-grow: 1;
  background: rgba(58, 56, 54, 0.7);
  border: 1px solid #3a3836;
  border-radius: 8px;
  padding: 8px 12px;
  color: white;
}

.chat-input button {
  background: #7f5af0;
  border: none;
  border-radius: 8px;
  padding: 8px 15px;
  color: white;
  cursor: pointer;
}

.message {
  margin-bottom: 10px;
  padding: 8px 12px;
  background: rgba(58, 56, 54, 0.5);
  border-radius: 8px;
  word-break: break-word;
}

.message-sender {
  font-weight: bold;
  color: #7f5af0;
  margin-right: 5px;
}

.your-message {
  background: rgba(127, 90, 240, 0.2);
  border-left: 3px solid #7f5af0;
}

.tab-content { 
  display: none;
  text-align: center;
}
.tab-content.active { display: block; }

.tab-buttons {
  display: flex;
  justify-content: center;
  gap: 25px;
  margin-bottom: 25px;
}

.tab-button {
  background: none;
  border: none;
  color: white;
  padding: 12px 25px;
  font-size: 1.3rem;
  cursor: pointer;
  position: relative;
  transition: all 0.3s ease;
}

.tab-button.active {
  color: #7f5af0;
  text-shadow: 0 0 8px #7f5af0;
}

.shop-item {
  margin: 15px 0;
  padding: 15px;
  background: rgba(58, 56, 54, 0.5);
  border-radius: 12px;
  border-left: 3px solid #7f5af0;
}

@keyframes rotate {
  from { transform: rotate(0deg); }
  to { transform: rotate(360deg); }
}

@keyframes initialZoom {
  0% { transform: scale(0.5); opacity: 0; }
  50% { transform: scale(1.2); opacity: 1; }
  100% { transform: scale(1); opacity: 1; }
}

@keyframes flyThrough {
  0% { transform: scale(1) translateZ(0); opacity: 1; }
  100% { transform: scale(5) translateZ(800px); opacity: 0; }
}

@keyframes titleAppear {
  0% { opacity: 0; filter: blur(15px); transform: translate(-50%, -50%) scale(0.8); }
  100% { opacity: 1; filter: blur(0); transform: translate(-50%, -50%) scale(1); }
}

@keyframes titleMoveUp {
  0% { top: 50%; opacity: 1; }
  100% { top: 20%; opacity: 0.7; }
}

@keyframes slideUp {
  0% { bottom: -300px; opacity: 0; }
  100% { bottom: 30px; opacity: 1; }
}
</style>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-database-compat.js"></script>
</head>
<body>

<div id="ring-container">
  <div id="ring"></div>
</div>

<div id="title">Gizmo</div>

<div id="content">
  <div id="panel">
    <div class="tab-buttons">
      <button class="tab-button active" onclick="switchTab('profile')">–ü—Ä–æ—Ñ–∏–ª—å</button>
      <button class="tab-button" onclick="switchTab('shop')">–ú–∞–≥–∞–∑–∏–Ω</button>
      <button class="tab-button" onclick="toggleChat()">–ß–∞—Ç</button>
    </div>
    
    <div id="profile" class="tab-content active">
      <h2>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, <span id="username">–ò–≥—Ä–æ–∫</span>!</h2>
      <p>–í–∞—à —Å—Ç–∞—Ç—É—Å: –ù–æ–≤–∏—á–æ–∫</p>
    </div>
    
    <div id="shop" class="tab-content">
      <div class="shop-item">
        <h3>üó°Ô∏è –ú–µ—á –î—Ä–∞–∫–æ–Ω–∞</h3>
        <p style="color: #f8d56b;">100 –∑–æ–ª–æ—Ç—ã—Ö</p>
      </div>
      <div class="shop-item">
        <h3>üõ°Ô∏è –©–∏—Ç –†—ã—Ü–∞—Ä—è</h3>
        <p style="color: #f8d56b;">75 –∑–æ–ª–æ—Ç—ã—Ö</p>
      </div>
    </div>
  </div>
</div>

<div id="chat-container" class="chat-container">
  <div id="chat-messages" class="chat-messages"></div>
  <div class="chat-input">
    <input type="text" id="message-input" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ..." onkeypress="handleKeyPress(event)">
    <button onclick="sendMessage()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
  </div>
</div>

<script>
// –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Firebase (–∑–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ —Å–≤–æ—é!)
const firebaseConfig = {
  apiKey: "AIzaSyABCDEFGHIJKLMNOPQRSTUVWXYZ12345678",
  authDomain: "your-project-id.firebaseapp.com",
  databaseURL: "https://your-project-id.firebaseio.com",
  projectId: "your-project-id",
  storageBucket: "your-project-id.appspot.com",
  messagingSenderId: "123456789012",
  appId: "1:123456789012:web:abcdefghijklmnopqrstuv"
};

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Firebase
firebase.initializeApp(firebaseConfig);
const database = firebase.database();

// –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
let chatVisible = false;
let currentUser = {
  id: '',
  name: '–ì–æ—Å—Ç—å'
};

// –ê–Ω–∏–º–∞—Ü–∏—è –∫–æ–ª—å—Ü–∞
setTimeout(() => {
  document.getElementById('ring').style.animation = 'none';
  document.getElementById('ring').style.animation = 'flyThrough 2s ease-out forwards';
  
  setTimeout(() => {
    document.getElementById('ring-container').style.opacity = '0';
    setTimeout(() => {
      document.getElementById('ring-container').remove();
    }, 1000);
  }, 2000);
}, 4000);

// –ß–∞—Ç
function toggleChat() {
  chatVisible = !chatVisible;
  document.getElementById('chat-container').style.display = chatVisible ? 'flex' : 'none';
  if (chatVisible) {
    setTimeout(() => {
      document.getElementById('chat-messages').scrollTop = document.getElementById('chat-messages').scrollHeight;
    }, 100);
  }
}

function handleKeyPress(e) {
  if (e.key === 'Enter') {
    sendMessage();
  }
}

function sendMessage() {
  const input = document.getElementById('message-input');
  const message = input.value.trim();
  
  if (message) {
    // –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ Firebase
    database.ref('messages').push().set({
      senderId: currentUser.id,
      senderName: currentUser.name,
      text: message,
      timestamp: firebase.database.ServerValue.TIMESTAMP
    });
    
    input.value = '';
  }
}

function addMessage(senderId, senderName, text) {
  const messages = document.getElementById('chat-messages');
  const messageElement = document.createElement('div');
  
  messageElement.className = `message ${senderId === currentUser.id ? 'your-message' : ''}`;
  messageElement.innerHTML = `<span class="message-sender">${senderName}:</span> ${text}`;
  
  messages.appendChild(messageElement);
  messages.scrollTop = messages.scrollHeight;
}

// –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤–∫–ª–∞–¥–æ–∫
function switchTab(tabName) {
  document.querySelectorAll('.tab-content').forEach(tab => {
    tab.classList.remove('active');
  });
  document.querySelectorAll('.tab-button').forEach(btn => {
    btn.classList.remove('active');
  });
  
  document.getElementById(tabName).classList.add('active');
  event.target.classList.add('active');
}

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
document.addEventListener('DOMContentLoaded', () => {
  // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  if (window.Telegram && Telegram.WebApp) {
    const tgUser = Telegram.WebApp.initDataUnsafe.user;
    if (tgUser) {
      currentUser = {
        id: tgUser.id.toString(),
        name: tgUser.first_name || 'Telegram User'
      };
      document.getElementById('username').textContent = currentUser.name;
    }
    Telegram.WebApp.expand();
  } else {
    // –î–ª—è —Ç–µ—Å—Ç–∞ –≤–Ω–µ Telegram
    currentUser = {
      id: 'guest_' + Math.random().toString(36).substr(2, 9),
      name: '–ì–æ—Å—Ç—å'
    };
  }

  // –ó–∞–≥—Ä—É–∂–∞–µ–º –∏—Å—Ç–æ—Ä–∏—é —Å–æ–æ–±—â–µ–Ω–∏–π
  database.ref('messages').orderByChild('timestamp').limitToLast(50).on('child_added', (snapshot) => {
    const msg = snapshot.val();
    addMessage(msg.senderId, msg.senderName, msg.text);
  });

  // –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∞–Ω–∏–º–∞—Ü–∏–π
  const elements = document.querySelectorAll('#ring, #title, #panel, #chat-container');
  elements.forEach(el => {
    el.style.willChange = 'transform, opacity, filter';
  });
});
</script>
</body>
</html>