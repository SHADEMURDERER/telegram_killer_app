<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Gizmo App</title>
<style>
body {
  margin: 0;
  background: #2a2826;
  color: white;
  font-family: 'Arial', sans-serif;
  height: 100vh;
  overflow: hidden;
  perspective: 1000px;
}

#ring-container {
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%) translateZ(0);
  width: 100vw;
  height: 100vh;
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 1000;
  background-color: #2a2826;
  transform-style: preserve-3d;
}

#ring {
  width: 600px;
  height: 600px;
  background: url('./images/anim.gif') center/contain no-repeat;
  animation: 
    rotate 4s linear infinite,
    initialZoom 2s ease-out forwards;
  transform-style: preserve-3d;
}

#title {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  font-size: 4.5rem;
  font-weight: bold;
  color: white;
  text-shadow: 0 0 15px rgba(255,255,255,0.7);
  opacity: 0;
  filter: blur(15px);
  z-index: 1001;
  animation: 
    titleAppear 1.5s 4s ease-out forwards,
    titleMoveUp 1.5s 6s ease-out forwards;
}

#panel {
  position: fixed;
  bottom: -300px;
  left: 50%;
  transform: translateX(-50%);
  width: 90%;
  max-width: 500px;
  background: rgba(42, 40, 38, 0.97);
  backdrop-filter: blur(12px);
  border-radius: 25px;
  padding: 25px;
  box-shadow: 0 -8px 30px rgba(0,0,0,0.4);
  z-index: 1002;
  animation: slideUp 1.5s 6s ease-out forwards;
  will-change: transform;
  border: 1px solid #3a3836;
}

@keyframes rotate {
  from { transform: rotate(0deg); }
  to { transform: rotate(360deg); }
}

@keyframes initialZoom {
  0% { transform: scale(0.5); opacity: 0; }
  50% { transform: scale(1.2); opacity: 1; }
  100% { transform: scale(1); opacity: 1; }
}

@keyframes flyThrough {
  0% { transform: scale(1) translateZ(0); opacity: 1; }
  100% { transform: scale(5) translateZ(800px); opacity: 0; }
}

@keyframes titleAppear {
  0% { opacity: 0; filter: blur(15px); transform: translate(-50%, -50%) scale(0.8); }
  100% { opacity: 1; filter: blur(0); transform: translate(-50%, -50%) scale(1); }
}

@keyframes titleMoveUp {
  0% { top: 50%; opacity: 1; }
  100% { top: 20%; opacity: 0.7; }
}

@keyframes slideUp {
  0% { bottom: -300px; opacity: 0; }
  100% { bottom: 30px; opacity: 1; }
}

.tab-content { 
  display: none;
  text-align: center;
}
.tab-content.active { display: block; }

.tab-buttons {
  display: flex;
  justify-content: center;
  gap: 25px;
  margin-bottom: 25px;
}

.tab-button {
  background: none;
  border: none;
  color: white;
  padding: 12px 25px;
  font-size: 1.3rem;
  cursor: pointer;
  position: relative;
  transition: all 0.3s ease;
}

.tab-button.active {
  color: #7f5af0;
  text-shadow: 0 0 8px #7f5af0;
}

.shop-item {
  margin: 15px 0;
  padding: 15px;
  background: rgba(58, 56, 54, 0.5);
  border-radius: 12px;
  border-left: 3px solid #7f5af0;
}

/* PVP Wheel Styles */
#pvp-wheel-container {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0,0,0,0.8);
  z-index: 2000;
  justify-content: center;
  align-items: center;
  flex-direction: column;
}

#wheel {
  width: 300px;
  height: 300px;
  border-radius: 50%;
  position: relative;
  overflow: hidden;
  border: 5px solid #3a3836;
  box-shadow: 0 0 20px rgba(0,0,0,0.5);
}

.wheel-segment {
  position: absolute;
  width: 50%;
  height: 50%;
  transform-origin: bottom right;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
}

.wheel-pointer {
  position: absolute;
  top: 10px;
  left: 50%;
  transform: translateX(-50%);
  width: 0;
  height: 0;
  border-left: 15px solid transparent;
  border-right: 15px solid transparent;
  border-top: 30px solid #7f5af0;
  z-index: 10;
}

#wheel-result {
  margin-top: 20px;
  font-size: 1.5rem;
  color: #7f5af0;
  text-shadow: 0 0 8px #7f5af0;
}

#pvp-bet {
  margin-top: 20px;
  padding: 10px 20px;
  background: #7f5af0;
  color: white;
  border: none;
  border-radius: 10px;
  font-size: 1.2rem;
  cursor: pointer;
}

#pvp-chance {
  margin-top: 10px;
  font-size: 1.1rem;
}
</style>
</head>
<body>

<div id="ring-container">
  <div id="ring"></div>
</div>

<div id="title">Gizmo</div>

<div id="content">
  <div id="panel">
    <div class="tab-buttons">
      <button class="tab-button active" onclick="switchTab('profile')">–ü—Ä–æ—Ñ–∏–ª—å</button>
      <button class="tab-button" onclick="switchTab('shop')">–ú–∞–≥–∞–∑–∏–Ω</button>
      <button class="tab-button" onclick="openPvpWheel()">PVP</button>
    </div>
    
    <div id="profile" class="tab-content active">
      <h2>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, <span id="username">–ò–≥—Ä–æ–∫</span>!</h2>
      <p>–í–∞—à —Å—Ç–∞—Ç—É—Å: –ù–æ–≤–∏—á–æ–∫</p>
    </div>
    
    <div id="shop" class="tab-content">
      <div class="shop-item">
        <h3>üó°Ô∏è –ú–µ—á –î—Ä–∞–∫–æ–Ω–∞</h3>
        <p style="color: #f8d56b;">100 –∑–æ–ª–æ—Ç—ã—Ö</p>
      </div>
      <div class="shop-item">
        <h3>üõ°Ô∏è –©–∏—Ç –†—ã—Ü–∞—Ä—è</h3>
        <p style="color: #f8d56b;">75 –∑–æ–ª–æ—Ç—ã—Ö</p>
      </div>
    </div>
  </div>
</div>

<div id="pvp-wheel-container">
  <div id="wheel">
    <div class="wheel-pointer"></div>
  </div>
  <div id="wheel-result"></div>
  <div id="pvp-chance">–®–∞–Ω—Å –ø–æ–±–µ–¥—ã: 50%</div>
  <button id="pvp-bet" onclick="placeBet()">–°–¥–µ–ª–∞—Ç—å —Å—Ç–∞–≤–∫—É (50 –∑–æ–ª–æ—Ç—ã—Ö)</button>
</div>

<script>
// –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
let playerId = Math.random().toString(36).substring(2, 15);
let gameState = {
  player1: null,
  player2: null,
  spinning: false
};

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
document.addEventListener('DOMContentLoaded', () => {
  if (window.Telegram && Telegram.WebApp) {
    const user = Telegram.WebApp.initDataUnsafe.user;
    if (user?.first_name) {
      document.getElementById('username').textContent = user.first_name;
    }
    Telegram.WebApp.expand();
  }
  
  const elements = document.querySelectorAll('#ring, #title, #panel');
  elements.forEach(el => {
    el.style.willChange = 'transform, opacity, filter';
  });
  
  // –ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∏–≥—Ä—ã
  loadGameState();
  
  // –ó–∞–ø—É—Å–∫ –∞–Ω–∏–º–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ 4 —Å–µ–∫—É–Ω–¥—ã
  setTimeout(() => {
    document.getElementById('ring').style.animation = 'none';
    document.getElementById('ring').style.animation = 'flyThrough 2s ease-out forwards';
    
    setTimeout(() => {
      document.getElementById('ring-container').style.opacity = '0';
      setTimeout(() => {
        document.getElementById('ring-container').remove();
      }, 1000);
    }, 2000);
  }, 4000);
  
  // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∏–≥—Ä—ã –∫–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É
  setInterval(checkGameState, 1000);
});

function switchTab(tabName) {
  document.querySelectorAll('.tab-content').forEach(tab => {
    tab.classList.remove('active');
  });
  document.querySelectorAll('.tab-button').forEach(btn => {
    btn.classList.remove('active');
  });
  
  document.getElementById(tabName).classList.add('active');
  event.target.classList.add('active');
}

// PVP Wheel Logic
function openPvpWheel() {
  document.getElementById('pvp-wheel-container').style.display = 'flex';
  updateWheelUI();
}

function closePvpWheel() {
  document.getElementById('pvp-wheel-container').style.display = 'none';
}

function loadGameState() {
  const savedState = localStorage.getItem('pvpWheelState');
  if (savedState) {
    gameState = JSON.parse(savedState);
  }
  updateWheelUI();
}

function saveGameState() {
  localStorage.setItem('pvpWheelState', JSON.stringify(gameState));
}

function checkGameState() {
  const oldState = JSON.stringify(gameState);
  loadGameState();
  
  if (gameState.spinning) {
    // –ò–≥—Ä–∞ —É–∂–µ –∏–¥–µ—Ç, –æ–±–Ω–æ–≤–ª—è–µ–º UI
    updateWheelUI();
    return;
  }
  
  if (gameState.player1 && gameState.player2 && !gameState.spinning) {
    // –û–±–∞ –∏–≥—Ä–æ–∫–∞ —Å–¥–µ–ª–∞–ª–∏ —Å—Ç–∞–≤–∫–∏ - –∑–∞–ø—É—Å–∫–∞–µ–º –∫–æ–ª–µ—Å–æ
    startSpinning();
  }
  
  if (JSON.stringify(gameState) !== oldState) {
    updateWheelUI();
  }
}

function updateWheelUI() {
  const wheel = document.getElementById('wheel');
  const betButton = document.getElementById('pvp-bet');
  
  wheel.innerHTML = '<div class="wheel-pointer"></div>';
  
  // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —Å–¥–µ–ª–∞–ª –ª–∏ —Ç–µ–∫—É—â–∏–π –∏–≥—Ä–æ–∫ —Å—Ç–∞–≤–∫—É
  const isPlayer1 = gameState.player1 === playerId;
  const isPlayer2 = gameState.player2 === playerId;
  const hasBet = isPlayer1 || isPlayer2;
  
  if (gameState.player1 || gameState.player2) {
    const segments = gameState.player1 && gameState.player2 ? 2 : 1;
    const angle = 360 / segments;
    
    for (let i = 0; i < segments; i++) {
      const segment = document.createElement('div');
      segment.className = 'wheel-segment';
      segment.style.transform = `rotate(${angle * i}deg)`;
      segment.style.backgroundColor = i === 0 ? '#FF5252' : '#4FC3F7';
      wheel.appendChild(segment);
    }
  }
  
  if (gameState.spinning) {
    betButton.disabled = true;
    betButton.textContent = '–ö–æ–ª–µ—Å–æ –∫—Ä—É—Ç–∏—Ç—Å—è...';
    document.getElementById('pvp-chance').textContent = '–ò–¥–µ—Ç –∏–≥—Ä–∞...';
  } else if (gameState.player1 && gameState.player2) {
    betButton.disabled = hasBet;
    betButton.textContent = hasBet ? '–û–∂–∏–¥–∞–Ω–∏–µ –∑–∞–ø—É—Å–∫–∞...' : '–ü—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è –∫ –∏–≥—Ä–µ';
    document.getElementById('pvp-chance').textContent = '–®–∞–Ω—Å –ø–æ–±–µ–¥—ã: 50% / 50%';
  } else if (gameState.player1 || gameState.player2) {
    if (hasBet) {
      betButton.disabled = true;
      betButton.textContent = '–û–∂–∏–¥–∞–Ω–∏–µ —Å–æ–ø–µ—Ä–Ω–∏–∫–∞...';
      document.getElementById('pvp-chance').textContent = '–®–∞–Ω—Å –ø–æ–±–µ–¥—ã: 100% (–∂–¥–µ–º –≤—Ç–æ—Ä–æ–≥–æ –∏–≥—Ä–æ–∫–∞)';
    } else {
      betButton.disabled = false;
      betButton.textContent = '–ü—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è (50 –∑–æ–ª–æ—Ç—ã—Ö)';
      document.getElementById('pvp-chance').textContent = '–®–∞–Ω—Å –ø–æ–±–µ–¥—ã: 50%';
    }
  } else {
    betButton.disabled = false;
    betButton.textContent = '–°–æ–∑–¥–∞—Ç—å –∏–≥—Ä—É (50 –∑–æ–ª–æ—Ç—ã—Ö)';
    document.getElementById('pvp-chance').textContent = '–®–∞–Ω—Å –ø–æ–±–µ–¥—ã: 50%';
  }
}

function placeBet() {
  if (gameState.spinning) return;
  
  if (!gameState.player1) {
    gameState.player1 = playerId;
  } else if (!gameState.player2 && gameState.player1 !== playerId) {
    gameState.player2 = playerId;
  }
  
  saveGameState();
  updateWheelUI();
}

function startSpinning() {
  gameState.spinning = true;
  saveGameState();
  
  const wheel = document.getElementById('wheel');
  const result = document.getElementById('wheel-result');
  
  result.textContent = '';
  
  const spinDuration = 3000;
  const spins = 5;
  const finalAngle = Math.floor(Math.random() * 360);
  const totalRotation = spins * 360 + finalAngle;
  
  wheel.style.transition = `transform ${spinDuration}ms cubic-bezier(0.17, 0.67, 0.21, 0.99)`;
  wheel.style.transform = `rotate(${totalRotation}deg)`;
  
  setTimeout(() => {
    const winningSegment = (360 - (finalAngle % 360)) < 180 ? 0 : 1;
    const winner = winningSegment === 0 ? '–ò–≥—Ä–æ–∫ 1' : '–ò–≥—Ä–æ–∫ 2';
    result.textContent = `–ü–æ–±–µ–¥–∏—Ç–µ–ª—å: ${winner}!`;
    
    setTimeout(() => {
      // –°–±—Ä–æ—Å –∏–≥—Ä—ã
      gameState.player1 = null;
      gameState.player2 = null;
      gameState.spinning = false;
      saveGameState();
      
      wheel.style.transition = 'none';
      wheel.style.transform = 'rotate(0deg)';
      setTimeout(() => {
        updateWheelUI();
      }, 10);
    }, 3000);
  }, spinDuration);
}
</script>
</body>
</html>