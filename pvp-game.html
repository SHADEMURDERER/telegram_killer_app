<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Gizmo PVP</title>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
  <style>
    body {
      background: #2a2826;
      color: white;
      font-family: Arial, sans-serif;
      text-align: center;
      padding: 20px;
      margin: 0;
    }
    #pvp-container {
      max-width: 500px;
      margin: 0 auto;
    }
    #action-button {
      background: #7f5af0;
      color: white;
      border: none;
      padding: 12px 25px;
      font-size: 18px;
      border-radius: 10px;
      cursor: pointer;
      margin: 20px 0;
    }
    #version {
      color: #7f5af0;
      font-size: 12px;
      margin-top: 30px;
    }
  </style>
</head>
<body>

<div id="pvp-container">
  <h1>‚öîÔ∏è PVP –ê—Ä–µ–Ω–∞</h1>
  <div id="game-status">–ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É –Ω–∏–∂–µ</div>
  <button id="action-button">–ù–∞—á–∞—Ç—å –±–æ–π (50üí∞)</button>
  <div id="result"></div>
  <div id="version">Build 0.4v (fixed null error)</div>
</div>

<script>
// 1. –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –≤—Å–µ DOM-—ç–ª–µ–º–µ–Ω—Ç—ã —Å—É—â–µ—Å—Ç–≤—É—é—Ç
const elements = {
  button: document.getElementById('action-button'),
  status: document.getElementById('game-status'),
  result: document.getElementById('result')
};

if (!elements.button || !elements.status || !elements.result) {
  console.error("–û—à–∏–±–∫–∞: –ù–µ –Ω–∞–π–¥–µ–Ω—ã –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã DOM");
  elements.status.textContent = "–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞";
} else {
  // 2. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Firebase
  const firebaseConfig = {
  apiKey: "AIzaSyC6EklCDD25kU_nuXyeh5mj9F24KECyYpM",
  databaseURL: "https://gizmo-27843-default-rtdb.firebaseio.com"
};

try {
  const app = firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
  db.ref('.info/connected').on('value', (snap) => {
    if (snap.val() === true) {
      console.log("Firebase –ø–æ–¥–∫–ª—é—á—ë–Ω!");
    } else {
      console.error("–ù–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Firebase");
    }
  });

  document.getElementById('action-button').addEventListener('click', async () => {
    const button = document.getElementById('action-button');
    button.disabled = true;
    
    try {
      // –¢–µ—Å—Ç –∑–∞–ø–∏—Å–∏ (–¥–æ–ª–∂–µ–Ω —Ä–∞–±–æ—Ç–∞—Ç—å –ø–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–∞–≤–∏–ª)
      await db.ref('test_connection').set({ 
        timestamp: Date.now(),
        message: "–¢–µ—Å—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è"
      });

      // –°–æ–∑–¥–∞—ë–º –∏–≥—Ä—É
      const newGameRef = db.ref('games').push();
      await newGameRef.set({
        player1: {
          id: 'player_' + Math.random().toString(36).slice(2, 9),
          name: '–ò–≥—Ä–æ–∫'
        },
        status: 'waiting',
        createdAt: Date.now()
      });

      console.log("–ò–≥—Ä–∞ —Å–æ–∑–¥–∞–Ω–∞! ID:", newGameRef.key);
      document.getElementById('game-status').textContent = "–û–∂–∏–¥–∞–µ–º —Å–æ–ø–µ—Ä–Ω–∏–∫–∞...";

    } catch (error) {
      console.error("–û—à–∏–±–∫–∞ Firebase:", error);
      alert("–û—à–∏–±–∫–∞: " + error.message);
      button.disabled = false;
    }
  });

} catch (error) {
  console.error("–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ Firebase:", error);
  document.getElementById('game-status').textContent = "–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ Firebase";
}
}
</script>
</body>
</html>