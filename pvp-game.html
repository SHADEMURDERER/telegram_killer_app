<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Gizmo PVP</title>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
  <style>
    body {
      background: #2a2826;
      color: white;
      font-family: Arial, sans-serif;
      text-align: center;
      padding: 20px;
      margin: 0;
    }
    #pvp-container {
      max-width: 500px;
      margin: 0 auto;
    }
    #action-button {
      background: #7f5af0;
      color: white;
      border: none;
      padding: 12px 25px;
      font-size: 18px;
      border-radius: 10px;
      cursor: pointer;
      margin: 20px 0;
    }
    #version {
      color: #7f5af0;
      font-size: 12px;
      margin-top: 30px;
    }
  </style>
</head>
<body>

<div id="pvp-container">
  <h1>‚öîÔ∏è PVP –ê—Ä–µ–Ω–∞</h1>
  <div id="game-status">–ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É –Ω–∏–∂–µ</div>
  <button id="action-button">–ù–∞—á–∞—Ç—å –±–æ–π (50üí∞)</button>
  <div id="result"></div>
  <div id="version">Build 0.4v (fixed null error)</div>
</div>

<script>
// 1. –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –≤—Å–µ DOM-—ç–ª–µ–º–µ–Ω—Ç—ã —Å—É—â–µ—Å—Ç–≤—É—é—Ç
const elements = {
  button: document.getElementById('action-button'),
  status: document.getElementById('game-status'),
  result: document.getElementById('result')
};

if (!elements.button || !elements.status || !elements.result) {
  console.error("–û—à–∏–±–∫–∞: –ù–µ –Ω–∞–π–¥–µ–Ω—ã –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã DOM");
  elements.status.textContent = "–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞";
} else {
  // 2. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Firebase
  const firebaseConfig = {
    apiKey: "AIzaSyC6EklCDD25kU_nuXyeh5mj9F24KECyYpM",
    databaseURL: "https://gizmo-27843-default-rtdb.firebaseio.com"
  };

  try {
    const app = firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // 3. –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ —Å –∑–∞—â–∏—Ç–æ–π –æ—Ç –æ—à–∏–±–æ–∫
    elements.button.addEventListener('click', async () => {
      try {
        elements.button.disabled = true;
        elements.status.textContent = "–°–æ–∑–¥–∞—ë–º –∏–≥—Ä—É...";
        
        // –¢–µ—Å—Ç –∑–∞–ø–∏—Å–∏
        await db.ref('connection_test').set({ timestamp: Date.now() });
        
        // –°–æ–∑–¥–∞–µ–º –∏–≥—Ä—É
        const newGameRef = db.ref('games').push();
        await newGameRef.set({
          player1: { id: 'test_id', name: '–¢–µ—Å—Ç–æ–≤—ã–π –∏–≥—Ä–æ–∫' },
          status: 'waiting'
        });

        elements.status.textContent = "–û–∂–∏–¥–∞–µ–º —Å–æ–ø–µ—Ä–Ω–∏–∫–∞...";
        console.log("–ò–≥—Ä–∞ —Å–æ–∑–¥–∞–Ω–∞, ID:", newGameRef.key);
      } catch (error) {
        console.error("–û—à–∏–±–∫–∞ Firebase:", error);
        elements.status.textContent = "–û—à–∏–±–∫–∞: " + error.message;
        elements.button.disabled = false;
      }
    });

  } catch (error) {
    console.error("–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ Firebase:", error);
    elements.status.textContent = "–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ —Å–µ—Ä–≤–µ—Ä—É";
  }
}
</script>
</body>
</html>