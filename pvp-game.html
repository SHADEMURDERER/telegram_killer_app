<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Gizmo PVP (–ö–æ–º–Ω–∞—Ç—ã)</title>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
  <style>
    body {
      background: #2a2826;
      color: white;
      font-family: Arial, sans-serif;
      text-align: center;
      padding: 20px;
    }
    #room-id-input {
      padding: 10px;
      width: 200px;
      margin-right: 10px;
    }
    #action-button {
      background: #7f5af0;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 5px;
      cursor: pointer;
    }
  </style>
</head>
<body>

<div id="pvp-container">
  <h2>üéÆ –ö–æ–º–Ω–∞—Ç—ã PVP</h2>
  <input type="text" id="room-id-input" placeholder="ID –∫–æ–º–Ω–∞—Ç—ã">
  <button id="action-button">–ü—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è</button>
  <div id="game-status"></div>
  <div id="version">Build 1.0v (Room System)</div>
</div>

<script>
// –ö–æ–Ω—Ñ–∏–≥ Firebase
const firebaseConfig = {
  apiKey: "AIzaSyC6EklCDD25kU_nuXyeh5mj9F24KECyYpM",
  databaseURL: "https://gizmo-27843-default-rtdb.firebaseio.com"
};

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
const app = firebase.initializeApp(firebaseConfig);
const db = firebase.database();

// –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
let currentRoomId = null;
const currentPlayer = {
  id: 'player_' + Math.random().toString(36).slice(2, 9),
  name: '–ò–≥—Ä–æ–∫'
};

// –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏
document.getElementById('action-button').addEventListener('click', () => {
  const roomId = document.getElementById('room-id-input').value.trim();
  if (!roomId) return alert("–í–≤–µ–¥–∏—Ç–µ ID –∫–æ–º–Ω–∞—Ç—ã!");
  
  joinOrCreateRoom(roomId);
});

// –õ–æ–≥–∏–∫–∞ –∫–æ–º–Ω–∞—Ç—ã
async function joinOrCreateRoom(roomId) {
  const button = document.getElementById('action-button');
  button.disabled = true;
  document.getElementById('game-status').textContent = "–ü–æ–¥–∫–ª—é—á–∞–µ–º—Å—è...";

  try {
    const roomRef = db.ref('rooms/' + roomId);
    const snapshot = await roomRef.once('value');
    
    if (!snapshot.exists()) {
      // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—É—é –∫–æ–º–Ω–∞—Ç—É
      await roomRef.set({
        player1: currentPlayer,
        player2: null,
        status: 'waiting'
      });
      document.getElementById('game-status').textContent = "–ö–æ–º–Ω–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∞! –û–∂–∏–¥–∞–µ–º —Å–æ–ø–µ—Ä–Ω–∏–∫–∞...";
    } else {
      // –ü—Ä–∏—Å–æ–µ–¥–∏–Ω—è–µ–º—Å—è –∫ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π
      const room = snapshot.val();
      if (room.player2) {
        throw new Error("–ö–æ–º–Ω–∞—Ç–∞ —É–∂–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–∞");
      }
      
      await roomRef.update({
        player2: currentPlayer,
        status: 'playing'
      });
      document.getElementById('game-status').textContent = `–í—ã –∏–≥—Ä–∞–µ—Ç–µ –ø—Ä–æ—Ç–∏–≤ ${room.player1.name}!`;
    }

    currentRoomId = roomId;
    startGameMonitoring(roomRef);
    
  } catch (error) {
    console.error("–û—à–∏–±–∫–∞ –∫–æ–º–Ω–∞—Ç—ã:", error);
    alert("–û—à–∏–±–∫–∞: " + error.message);
    button.disabled = false;
  }
}

// –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ –∫–æ–º–Ω–∞—Ç–µ
function startGameMonitoring(roomRef) {
  roomRef.on('value', (snapshot) => {
    const room = snapshot.val();
    if (!room) return;

    if (room.status === 'playing' && room.player1 && room.player2) {
      // –ó–∞–ø—É—Å–∫ –∏–≥—Ä—ã
      document.getElementById('game-status').textContent = "–ò–≥—Ä–∞ –Ω–∞—á–∞–ª–∞—Å—å!";
      
      setTimeout(() => {
        const winner = Math.random() > 0.5 ? room.player1 : room.player2;
        roomRef.update({ winner: winner.id, status: 'finished' });
      }, 3000);
    }

    if (room.status === 'finished') {
      document.getElementById('game-status').textContent = 
        room.winner === currentPlayer.id ? "–í—ã –ø–æ–±–µ–¥–∏–ª–∏!" : "–í—ã –ø—Ä–æ–∏–≥—Ä–∞–ª–∏";
    }
  });
}
</script>
</body>
</html>