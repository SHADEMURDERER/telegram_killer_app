<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Gizmo PVP</title>
  <!-- Firebase 9 (—Å—Ç–∞–±–∏–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è) -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
  <style>
    body {
      background: #2a2826;
      color: white;
      font-family: Arial, sans-serif;
      text-align: center;
      padding: 20px;
      margin: 0;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }
    #pvp-container {
      max-width: 500px;
      margin: 0 auto;
      flex: 1;
    }
    #action-button {
      background: #7f5af0;
      color: white;
      border: none;
      padding: 12px 25px;
      font-size: 18px;
      border-radius: 10px;
      cursor: pointer;
      margin: 20px 0;
      transition: background 0.3s;
    }
    #action-button:hover {
      background: #6a4ac9;
    }
    #action-button:disabled {
      background: #555;
      cursor: not-allowed;
    }
    #version {
      color: #7f5af0;
      font-size: 12px;
      margin-top: 30px;
    }
  </style>
</head>
<body>

<div id="pvp-container">
  <h1>‚öîÔ∏è PVP –ê—Ä–µ–Ω–∞</h1>
  <div id="game-status">–ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É –Ω–∏–∂–µ</div>
  <button id="action-button">–ù–∞—á–∞—Ç—å –±–æ–π (50üí∞)</button>
  <div id="result"></div>
  
  <!-- –°—Ç—Ä–æ–∫–∞ —Å –≤–µ—Ä—Å–∏–µ–π -->
  <div id="version">Build 0.1v</div>
</div>

<script>
// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Firebase
const firebaseConfig = {
  apiKey: "AIzaSyC6EklCDD25kU_nuXyeh5mj9F24KECyYpM",
  databaseURL: "https://gizmo-27843-default-rtdb.firebaseio.com"
};

try {
  const app = firebase.initializeApp(firebaseConfig);
  const db = firebase.database();
  
  // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
  db.ref('.info/connected').on('value', (snap) => {
    console.log(snap.val() ? "üî• Firebase –ø–æ–¥–∫–ª—é—á—ë–Ω" : "‚ùå –û—Ñ—Ñ–ª–∞–π–Ω");
  });

  // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏
  document.getElementById('action-button').addEventListener('click', async () => {
    const button = document.getElementById('action-button');
    button.disabled = true;
    document.getElementById('game-status').textContent = "–°–æ–∑–¥–∞—ë–º –∏–≥—Ä—É...";
    
    try {
      // –¢–µ—Å—Ç –∑–∞–ø–∏—Å–∏
      await db.ref('connection_test').set({ 
        timestamp: Date.now(),
        user: "test" 
      });
      
      // –°–æ–∑–¥–∞—ë–º –∏–≥—Ä—É
      const newGameRef = db.ref('games').push();
      await newGameRef.set({
        player1: {
          id: 'player_' + Math.random().toString(36).slice(2, 9),
          name: '–ò–≥—Ä–æ–∫'
        },
        status: 'waiting',
        createdAt: Date.now()
      });
      
      document.getElementById('game-status').textContent = "–û–∂–∏–¥–∞–µ–º —Å–æ–ø–µ—Ä–Ω–∏–∫–∞...";
      button.textContent = "–û—Ç–º–µ–Ω–∏—Ç—å –∏–≥—Ä—É";
      
      // –°–ª–µ–¥–∏–º –∑–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏
      newGameRef.on('value', (snapshot) => {
        const game = snapshot.val();
        if (game?.status === 'playing') {
          startGame(game);
        }
      });
      
    } catch (error) {
      console.error("–û—à–∏–±–∫–∞:", error);
      document.getElementById('game-status').textContent = "–û—à–∏–±–∫–∞: " + error.message;
      button.disabled = false;
    }
  });

  function startGame(game) {
    document.getElementById('game-status').textContent = "‚ö° –ë–æ–π –Ω–∞—á–∞–ª—Å—è!";
    document.getElementById('action-button').style.display = 'none';
    
    setTimeout(() => {
      const isWinner = Math.random() > 0.5;
      document.getElementById('result').textContent = isWinner 
        ? "üéâ –í—ã –ø–æ–±–µ–¥–∏–ª–∏!" 
        : "üò¢ –í—ã –ø—Ä–æ–∏–≥—Ä–∞–ª–∏";
      document.getElementById('action-button').style.display = 'block';
      document.getElementById('action-button').textContent = "–ò–≥—Ä–∞—Ç—å —Å–Ω–æ–≤–∞";
      document.getElementById('action-button').disabled = false;
    }, 3000);
  }

} catch (error) {
  console.error("–§–∞—Ç–∞–ª—å–Ω–∞—è –æ—à–∏–±–∫–∞ Firebase:", error);
  document.getElementById('game-status').textContent = "–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ Firebase";
}
</script>
</body>
</html>