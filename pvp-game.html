<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Gizmo PVP</title>
  <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º Firebase 9 (—Å—Ç–∞–±–∏–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è) -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
  <style>
    body {
      background: #2a2826;
      color: white;
      font-family: Arial, sans-serif;
      text-align: center;
      padding: 20px;
    }
    #pvp-container {
      max-width: 400px;
      margin: 0 auto;
    }
    #action-button {
      background: #7f5af0;
      color: white;
      border: none;
      padding: 12px 25px;
      font-size: 18px;
      border-radius: 10px;
      cursor: pointer;
      margin-top: 20px;
    }
    #action-button:disabled {
      background: #555;
      cursor: not-allowed;
    }
    #game-status {
      margin: 20px 0;
      font-size: 18px;
      min-height: 24px;
    }
  </style>
</head>
<body>

<div id="pvp-container">
  <h2>‚öîÔ∏è PVP –ê—Ä–µ–Ω–∞</h2>
  <div id="game-status">–ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É –Ω–∏–∂–µ</div>
  <button id="action-button">–ù–∞—á–∞—Ç—å –±–æ–π (50üí∞)</button>
  <div id="result"></div>
</div>

<script>
// 1. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Firebase
const firebaseConfig = {
  apiKey: "AIzaSyC6EklCDD25kU_nuXyeh5mj9F24KECyYpM",
  databaseURL: "https://gizmo-27843-default-rtdb.firebaseio.com"
};

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º Firebase
const app = firebase.initializeApp(firebaseConfig);
const db = firebase.database();

// 2. –°–æ–∑–¥–∞–µ–º –∏–≥—Ä–æ–∫–∞
const currentPlayer = {
  id: 'player_' + Math.random().toString(36).slice(2, 9),
  name: '–ò–≥—Ä–æ–∫'
};

// 3. –ü–æ–ª—É—á–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç—ã –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
const actionButton = document.getElementById('action-button');
const gameStatus = document.getElementById('game-status');
const resultDisplay = document.getElementById('result');

// 4. –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏
actionButton.addEventListener('click', async () => {
  actionButton.disabled = true;
  gameStatus.textContent = "–°–æ–∑–¥–∞—ë–º –∏–≥—Ä—É...";
  
  try {
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Firebase
    await db.ref('connection_test').set({ timestamp: Date.now() });
    
    // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—É—é –∏–≥—Ä—É
    const newGameRef = db.ref('games').push();
    await newGameRef.set({
      player1: currentPlayer,
      status: 'waiting',
      createdAt: Date.now()
    });
    
    gameStatus.textContent = "–û–∂–∏–¥–∞–µ–º —Å–æ–ø–µ—Ä–Ω–∏–∫–∞...";
    actionButton.textContent = "–û—Ç–º–µ–Ω–∏—Ç—å –∏–≥—Ä—É";
    
    // –°–ª—É—à–∞–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è –∏–≥—Ä—ã
    newGameRef.on('value', (snapshot) => {
      const game = snapshot.val();
      if (!game) return;
      
      if (game.status === 'playing') {
        startGame(game);
      }
    });
    
  } catch (error) {
    console.error("–û—à–∏–±–∫–∞ Firebase:", error);
    gameStatus.textContent = "–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∏–≥—Ä—ã";
    actionButton.disabled = false;
  }
});

// –ó–∞–ø—É—Å–∫ –∏–≥—Ä—ã
function startGame(game) {
  gameStatus.textContent = "–ò–≥—Ä–∞ –Ω–∞—á–∞–ª–∞—Å—å!";
  actionButton.style.display = "none";
  
  // –°–∏–º—É–ª—è—Ü–∏—è –±–æ—è (3 —Å–µ–∫—É–Ω–¥—ã)
  setTimeout(() => {
    const winner = Math.random() < 0.5 ? game.player1 : game.player2;
    resultDisplay.textContent = winner.id === currentPlayer.id 
      ? "üéâ –í—ã –ø–æ–±–µ–¥–∏–ª–∏! +50üí∞" 
      : "üò¢ –í—ã –ø—Ä–æ–∏–≥—Ä–∞–ª–∏";
    actionButton.style.display = "block";
    actionButton.textContent = "–ò–≥—Ä–∞—Ç—å —Å–Ω–æ–≤–∞";
    actionButton.disabled = false;
  }, 3000);
}
</script>
</body>
</html>